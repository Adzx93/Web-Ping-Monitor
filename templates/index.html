<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ping Monitor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta http-equiv="refresh" content="{{ auto_refresh }}">
    <style>
        body { font-family: Arial; margin: 20px; background: #f8f9fa; }
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 10px; border-bottom: 1px solid #ddd; }
        .up { color: green; font-weight: bold; }
        .down { color: red; font-weight: bold; }
        canvas { width: 100%; height: 100px; }
    </style>
</head>
<body>
    <h2>Ping Monitor Dashboard</h2>
    <p>Last updated: {{ last_updated }}</p>
    <table>
        <tr>
            <th>Hostname</th><th>IP</th><th>Status</th><th>Latency (ms)</th><th>Uptime (1h %)</th><th>History</th>
        </tr>
        {% for row in status %}
        <tr>
            <td>{{ row.hostname }}</td>
            <td>{{ row.ip }}</td>
            <td class="{{ 'up' if row.is_up else 'down' }}">{{ 'UP' if row.is_up else 'DOWN' }}</td>
            <td>{{ row.latency }}</td>
            <td>{{ row.uptime }}</td>
            <td><canvas id="chart_{{ loop.index }}"></canvas></td>
        </tr>
        <script>
        fetch(`/history/{{ row.ip }}.json`)
            .then(r => r.json())
            .then(data => {
                new Chart(document.getElementById('chart_{{ loop.index }}'), {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.timestamp.slice(11,19)),
                        datasets: [{
                            label: 'Latency (ms)',
                            data: data.map(d => d.latency),
                            borderColor: 'blue',
                            tension: 0.3,
                            pointRadius: 0
                        }]
                    },
                    options: { scales: { y: { beginAtZero: true } }, plugins: { legend: { display: false } } }
                });
            });
        </script>
        {% endfor %}
    </table>
</body>
</html>
